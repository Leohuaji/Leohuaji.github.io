<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Your site description"><link rel="shortcut icon" href=https://678210.xyz/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://678210.xyz/nginx_stream_tshock/><title>使用Nginx对TShock进行TCP/UDP代理</title></head><body><header id=banner><h2><a href=https://678210.xyz/>Leo Cheebin</a></h2><nav><ul><li><a href=/ title=Home>Home</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>使用Nginx对TShock进行TCP/UDP代理</h1><div><time>June 26, 2024</time></div></header><blockquote><p>给朋友分享自己的泰拉瑞亚服务，如果总是把服务器的ip暴露出去（如<code>172.xxx.xxx.120:7777</code>），既不优雅，也不安全，如果能用自己的域名就好了</p></blockquote><h3 id=步骤1>步骤1</h3><p>创建一个三级域名(如我的：tl.yaowan.icu)，将其解析到自己的服务器ip</p><p>并在安全组中开启一个向外暴露的端口（如泰拉瑞亚：7777端口）</p><p>（简单，不赘述）</p><h3 id=步骤2>步骤2</h3><p>在服务器安装Nginx</p><p>TShock使用TCP协议传输数据，需要使用Nginx的stream模块进行代理传输，而Nginx默认未添加stream模块故需要进行安装</p><blockquote><p>如果使用<code>yum install -y nginx</code>安装的Nginx，可使用<code>yum install nginx-mod-stream</code>直接加装stream模块</p></blockquote><p>安装完后，在nginx.conf添加如下stream流配置：</p><pre tabindex=0><code>stream {
    # Terraria game TCP config
    upstream terraria {
        server 127.0.0.1:7778; # 泰拉瑞亚服务器监听的地址和端口
    }

    server {
        listen 7777; # 这是对外部暴露的端口，也是游戏客户端将连接的端口
        proxy_pass terraria;
    }
}
</code></pre><blockquote><p><em>1.</em> 监听游戏运行端口，即TShock其中泰拉瑞亚服务时设置的端口，此处我设置成7778（可自行配置成需要的端口）</p><p><em>2.</em> 对外暴露的端口，即步骤一中开放的那个端口，此处我配置成泰拉瑞亚默认端口7777</p></blockquote><blockquote><p>这两处端口不能写成一样的了，否则会冲突；</p><p>stream块是与http块同一层级的块，勿将stream块写在http块中；</p></blockquote><p>添加完配置后，控制台执行<code>nginx -t</code>命令对添加的配置进行检测，如果返回如下结果，则表示配置没问题</p><pre tabindex=0><code>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
</code></pre><p>执行<code>nginx -s reload</code>命令使Nginx加载修改后的配置</p><h3 id=步骤3>步骤3</h3><p>运行TShock，并且在设置端口时，设置成Nginx配置中监听的游戏端口（如上述配置中的7778），此时就可以将你的游戏服务器，以<code>&lt;你的域名>:&lt;端口></code>形式分享出去了</p><p>比如我的服务器：</p><p><code>tl.yaowan.icu:7777</code> 密码你猜</p></article></main><footer id=footer>Copyright © Leo Cheebin
<a href=https://beian.miit.gov.cn/ style=color:#b3b3b3 target=_blank>赣ICP备2024035590号-3</a></footer></body></html>